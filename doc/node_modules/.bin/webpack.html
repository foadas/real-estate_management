<!DOCTYPE html>
<html>
<head>
  <title>webpack</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/webpack";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>webpack</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">command</span>
<span class="dox_type">string</span>
<span>process to run
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">args</span>
<span class="dox_type">Array.&lt;string&gt;</span>
<span>command line arguments
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> runCommand = <span class="hljs-function">(<span class="hljs-params">command, args</span>) =&gt;</span> {
	<span class="hljs-keyword">const</span> cp = <span class="hljs-built_in">require</span>(<span class="hljs-string">"child_process"</span>);
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
		<span class="hljs-keyword">const</span> executedCommand = cp.spawn(command, args, {
			<span class="hljs-attr">stdio</span>: <span class="hljs-string">"inherit"</span>,
			<span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>
		});

		executedCommand.on(<span class="hljs-string">"error"</span>, error =&gt; {
			reject(error);
		});

		executedCommand.on(<span class="hljs-string">"exit"</span>, code =&gt; {
			<span class="hljs-keyword">if</span> (code === <span class="hljs-number">0</span>) {
				resolve();
			} <span class="hljs-keyword">else</span> {
				reject();
			}
		});
	});
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">packageName</span>
<span class="dox_type">string</span>
<span>name of the package
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> isInstalled = <span class="hljs-function"><span class="hljs-params">packageName</span> =&gt;</span> {
	<span class="hljs-keyword">if</span> (process.versions.pnp) {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
	}

	<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
	<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"graceful-fs"</span>);

	<span class="hljs-keyword">let</span> dir = __dirname;

	<span class="hljs-keyword">do</span> {
		<span class="hljs-keyword">try</span> {
			<span class="hljs-keyword">if</span> (
				fs.statSync(path.join(dir, <span class="hljs-string">"node_modules"</span>, packageName)).isDirectory()
			) {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
			}
		} <span class="hljs-keyword">catch</span> (_error) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Nothing</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		}
	} <span class="hljs-keyword">while</span> (dir !== (dir = path.dirname(dir)));

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>https://github.com/nodejs/node/blob/v18.9.1/lib/internal/modules/cjs/loader.js#L1274
eslint-disable-next-line no-warning-comments
@ts-ignore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> internalPath <span class="hljs-keyword">of</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">"module"</span>).globalPaths) {
		<span class="hljs-keyword">try</span> {
			<span class="hljs-keyword">if</span> (fs.statSync(path.join(internalPath, packageName)).isDirectory()) {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
			}
		} <span class="hljs-keyword">catch</span> (_error) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Nothing</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		}
	}

	<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">cli</span>
<span class="dox_type">CliOption</span>
<span>options
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> runCli = <span class="hljs-function"><span class="hljs-params">cli</span> =&gt;</span> {
	<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
	<span class="hljs-keyword">const</span> pkgPath = <span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">`<span class="hljs-subst">${cli.package}</span>/package.json`</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>eslint-disable-next-line node/no-missing-require</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">const</span> pkg = <span class="hljs-built_in">require</span>(pkgPath);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>eslint-disable-next-line node/no-missing-require</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-built_in">require</span>(path.resolve(path.dirname(pkgPath), pkg.bin[cli.binName]));
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-comment">/** <span class="hljs-doctag">@type <span class="hljs-type">{CliOption}</span> </span>*/</span>
<span class="hljs-keyword">const</span> cli = {
	<span class="hljs-attr">name</span>: <span class="hljs-string">"webpack-cli"</span>,
	<span class="hljs-attr">package</span>: <span class="hljs-string">"webpack-cli"</span>,
	<span class="hljs-attr">binName</span>: <span class="hljs-string">"webpack-cli"</span>,
	<span class="hljs-attr">installed</span>: isInstalled(<span class="hljs-string">"webpack-cli"</span>),
	<span class="hljs-attr">url</span>: <span class="hljs-string">"https://github.com/webpack/webpack-cli"</span>
};

<span class="hljs-keyword">if</span> (!cli.installed) {
	<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
	<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"graceful-fs"</span>);
	<span class="hljs-keyword">const</span> readLine = <span class="hljs-built_in">require</span>(<span class="hljs-string">"readline"</span>);

	<span class="hljs-keyword">const</span> notify =
		<span class="hljs-string">"CLI for webpack must be installed.\n"</span> + <span class="hljs-string">`  <span class="hljs-subst">${cli.name}</span> (<span class="hljs-subst">${cli.url}</span>)\n`</span>;

	<span class="hljs-built_in">console</span>.error(notify);

	<span class="hljs-keyword">let</span> packageManager;

	<span class="hljs-keyword">if</span> (fs.existsSync(path.resolve(process.cwd(), <span class="hljs-string">"yarn.lock"</span>))) {
		packageManager = <span class="hljs-string">"yarn"</span>;
	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fs.existsSync(path.resolve(process.cwd(), <span class="hljs-string">"pnpm-lock.yaml"</span>))) {
		packageManager = <span class="hljs-string">"pnpm"</span>;
	} <span class="hljs-keyword">else</span> {
		packageManager = <span class="hljs-string">"npm"</span>;
	}

	<span class="hljs-keyword">const</span> installOptions = [packageManager === <span class="hljs-string">"yarn"</span> ? <span class="hljs-string">"add"</span> : <span class="hljs-string">"install"</span>, <span class="hljs-string">"-D"</span>];

	<span class="hljs-built_in">console</span>.error(
		<span class="hljs-string">`We will use "<span class="hljs-subst">${packageManager}</span>" to install the CLI via "<span class="hljs-subst">${packageManager}</span> <span class="hljs-subst">${installOptions.join(
			<span class="hljs-string">" "</span>
		)}</span> <span class="hljs-subst">${cli.package}</span>".`</span>
	);

	<span class="hljs-keyword">const</span> question = <span class="hljs-string">`Do you want to install 'webpack-cli' (yes/no): `</span>;

	<span class="hljs-keyword">const</span> questionInterface = readLine.createInterface({
		<span class="hljs-attr">input</span>: process.stdin,
		<span class="hljs-attr">output</span>: process.stderr
	});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>In certain scenarios (e.g. when STDIN is not in terminal mode), the callback function will not be
executed. Setting the exit code here to ensure the script exits correctly in those cases. The callback
function is responsible for clearing the exit code if the user wishes to install webpack-cli.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	process.exitCode = <span class="hljs-number">1</span>;
	questionInterface.question(question, answer =&gt; {
		questionInterface.close();

		<span class="hljs-keyword">const</span> normalizedAnswer = answer.toLowerCase().startsWith(<span class="hljs-string">"y"</span>);

		<span class="hljs-keyword">if</span> (!normalizedAnswer) {
			<span class="hljs-built_in">console</span>.error(
				<span class="hljs-string">"You need to install 'webpack-cli' to use webpack via CLI.\n"</span> +
					<span class="hljs-string">"You can also install the CLI manually."</span>
			);

			<span class="hljs-keyword">return</span>;
		}
		process.exitCode = <span class="hljs-number">0</span>;

		<span class="hljs-built_in">console</span>.log(
			<span class="hljs-string">`Installing '<span class="hljs-subst">${
				cli.package
			}</span>' (running '<span class="hljs-subst">${packageManager}</span> <span class="hljs-subst">${installOptions.join(<span class="hljs-string">" "</span>)}</span> <span class="hljs-subst">${
				cli.package
			}</span>')...`</span>
		);

		runCommand(packageManager, installOptions.concat(cli.package))
			.then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
				runCli(cli);
			})
			.catch(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
				<span class="hljs-built_in">console</span>.error(error);
				process.exitCode = <span class="hljs-number">1</span>;
			});
	});
} <span class="hljs-keyword">else</span> {
	runCli(cli);
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
